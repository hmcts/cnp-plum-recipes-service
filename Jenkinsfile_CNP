#!groovy

node {
  stage('Checkout') {
    checkout scm 
  }
  
  stage('Build') {
   sh "./gradlew check" 
  }
  
  stage('Analysis') {
   withSonarQubeEnv("SonarQube") {
    sh """./gradlew --info -Dsonar.pullrequest.key=${env.CHANGE_ID} \
        -Dsonar.pullrequest.base=${env.CHANGE_TARGET} \
        -Dsonar.pullrequest.branch=${env.CHANGE_BRANCH} \
        -Dsonar.pullrequest.provider=github \
        -Dsonar.pullrequest.github.repository=hmcts/cnp-plum-recipes-service \
        -Dsonar.pullrequest.github.endpoint=https://api.github.com/ \
     sonarqube
     """
   }
  }
}
